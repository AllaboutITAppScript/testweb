<!DOCTYPE html>
<html lang="th" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Code Tester Pro - Multi-language Code Editor</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .resizer {
            position: absolute;
            top: 0;
            right: -5px;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            z-index: 50;
        }
        
        .resizer:hover {
            background-color: rgba(59, 130, 246, 0.3);
        }
        
        .resizer.active {
            background-color: rgba(59, 130, 246, 0.5);
        }
        
        .code-editor {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            tab-size: 2;
            caret-color: white;
            white-space: pre;
            overflow-wrap: normal;
        }
        
        .code-editor:focus {
            outline: none;
        }
        
        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            border-radius: 0.5rem;
        }
        
        .dark .preview-frame {
            background: #1e293b;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .live-indicator {
            animation: pulse 2s infinite;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* Split view layout */
        .split-container {
            display: flex;
            height: calc(100vh - 120px);
            position: relative;
            overflow: hidden;
        }
        
        .editor-section {
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .preview-section {
            width: 50%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Editor with line numbers */
        .editor-wrapper {
            position: relative;
            flex: 1;
            overflow: hidden;
        }
        
        .line-numbers {
            position: absolute;
            left: 0;
            top: 0;
            width: 50px;
            height: 100%;
            background-color: #1f2937;
            color: #9ca3af;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            text-align: right;
            padding-top: 16px;
            padding-right: 10px;
            overflow: hidden;
            user-select: none;
            border-right: 1px solid #374151;
            z-index: 1;
        }
        
        .line-number {
            padding: 0 5px;
            height: 21px; /* Adjust based on line-height */
            display: block;
        }
        
        .line-number.current-line {
            background-color: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            font-weight: bold;
        }
        
        .line-number:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .text-editor {
            position: absolute;
            left: 50px;
            top: 0;
            width: calc(100% - 50px);
            height: 100%;
            background-color: transparent;
            color: #f3f4f6;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            border: none;
            padding: 16px 10px;
            resize: none;
            white-space: pre;
            overflow-wrap: normal;
            overflow: auto;
            z-index: 2;
        }
        
        /* Fullscreen mode */
        .fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 1000 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            border: none !important;
        }
        
        .fullscreen .text-editor {
            font-size: 16px !important;
            padding: 20px !important;
        }
        
        .fullscreen .line-numbers {
            width: 60px !important;
            font-size: 16px !important;
            padding-top: 20px !important;
        }
        
        .fullscreen .text-editor {
            left: 60px !important;
            width: calc(100% - 60px) !important;
        }
        
        /* Beautiful Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: -400px;
            z-index: 1000;
            transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 350px;
        }
        
        .notification.show {
            right: 20px;
        }
        
        .notification-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .notification-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .notification-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .notification-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        /* Modal for download */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background-color: #1f2937;
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(0);
            animation: modalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Language selector */
        .language-selector {
            position: relative;
            z-index: 10;
        }
        
        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            padding: 0.5rem 0;
            min-width: 180px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 100;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .language-dropdown.show {
            display: block;
            animation: fadeInDown 0.3s ease;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .language-option {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            border-left: 3px solid transparent;
        }
        
        .language-option:hover {
            background-color: #374151;
            border-left-color: #3b82f6;
        }
        
        .language-option.active {
            background-color: rgba(59, 130, 246, 0.2);
            border-left-color: #3b82f6;
        }
        
        /* Preview mode buttons */
        .preview-modes {
            display: flex;
            gap: 0.5rem;
            margin-right: 1rem;
        }
        
        .preview-mode-btn {
            padding: 0.5rem 1rem;
            background-color: #374151;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .preview-mode-btn:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
        }
        
        .preview-mode-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        /* Screen size modal */
        .screen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .screen-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .screen-modal-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #1f2937;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .screen-modal-header {
            padding: 1rem;
            background-color: #111827;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #374151;
        }
        
        .screen-modal-body {
            flex: 1;
            padding: 0.5rem;
            overflow: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .screen-modal-frame {
            border: none;
            background-color: white;
            border-radius: 0.375rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .screen-size-info {
            background-color: #374151;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        /* Console output */
        .console-output {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 1rem;
            overflow: auto;
            height: 100%;
            border-radius: 0.375rem;
        }
        
        .console-line {
            margin-bottom: 0.25rem;
            white-space: pre-wrap;
        }
        
        .console-command {
            color: #10b981;
        }
        
        .console-output-text {
            color: #e2e8f0;
        }
        
        .console-error {
            color: #ef4444;
        }
        
        .console-warning {
            color: #f59e0b;
        }
        
        .console-info {
            color: #3b82f6;
        }
        
        .console-success {
            color: #10b981;
        }
        
        /* Run code button animation */
        @keyframes runButtonPulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        .run-button-animation {
            animation: runButtonPulse 1.5s infinite;
        }
        
        /* Code execution result panel */
        .execution-result {
            background-color: #1e293b;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .execution-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #374151;
        }
        
        .execution-time {
            color: #94a3b8;
            font-size: 0.875rem;
        }
        
        /* Tab system for output */
        .output-tabs {
            display: flex;
            border-bottom: 1px solid #374151;
            margin-bottom: 1rem;
        }
        
        .output-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .output-tab:hover {
            background-color: #374151;
        }
        
        .output-tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .output-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .output-content.active {
            display: block;
        }
        
        /* Floating action button */
        .floating-action-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
            border: none;
        }
        
        .floating-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.4);
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Custom highlight for line numbers */
        .line-number.highlight {
            animation: highlightLine 1s ease;
            background-color: rgba(59, 130, 246, 0.3);
        }
        
        @keyframes highlightLine {
            0% { background-color: rgba(59, 130, 246, 0); }
            50% { background-color: rgba(59, 130, 246, 0.5); }
            100% { background-color: rgba(59, 130, 246, 0.3); }
        }
    </style>
</head>
<body class="dark:bg-gray-900 dark:text-gray-200 bg-gray-100 text-gray-800 transition-colors duration-300">
    <!-- Beautiful Notification -->
    <div id="notification" class="notification">
        <div class="notification-content" id="notification-content">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-xl mr-3"></i>
                <div>
                    <h4 class="font-bold" id="notification-title">ดำเนินการสำเร็จ</h4>
                    <p class="text-sm opacity-90" id="notification-text">ระบบได้บันทึกโค้ดของคุณแล้ว</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Download Modal -->
    <div id="download-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-download mr-2 text-blue-500"></i> ดาวน์โหลดไฟล์โค้ด
            </h3>
            <div class="mb-6">
                <label for="filename" class="block mb-2 font-medium">ชื่อไฟล์:</label>
                <input type="text" id="filename" class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" value="my-code.html">
                <p class="text-sm text-gray-400 mt-2" id="file-extension">ไฟล์จะถูกดาวน์โหลดเป็นไฟล์ .html</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancel-download" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">ยกเลิก</button>
                <button id="confirm-download" class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                    <i class="fas fa-download mr-2"></i> ดาวน์โหลด
                </button>
            </div>
        </div>
    </div>
    
    <!-- Screen Preview Modal -->
    <div id="screen-modal" class="screen-modal">
        <div class="screen-modal-content">
            <div class="screen-modal-header">
                <div class="flex items-center space-x-4">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-desktop mr-2 text-blue-500"></i> หน้าจอใหญ่สำหรับทดสอบ
                    </h3>
                    <div id="screen-size-display" class="screen-size-info">ขนาด: เดสก์ท็อป</div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="mobile-screen" class="preview-mode-btn">
                        <i class="fas fa-mobile-alt"></i> มือถือ
                    </button>
                    <button id="tablet-screen" class="preview-mode-btn">
                        <i class="fas fa-tablet-alt"></i> แท็บเล็ต
                    </button>
                    <button id="desktop-screen" class="preview-mode-btn active">
                        <i class="fas fa-desktop"></i> เดสก์ท็อป
                    </button>
                    <button id="full-screen" class="preview-mode-btn">
                        <i class="fas fa-expand"></i> เต็มจอ
                    </button>
                    <button id="close-screen-modal" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 transition-colors flex items-center">
                        <i class="fas fa-times mr-2"></i> ปิด
                    </button>
                </div>
            </div>
            <div class="screen-modal-body">
                <iframe id="screen-frame" class="screen-modal-frame"></iframe>
            </div>
        </div>
    </div>
    
    <!-- Floating Action Button for Quick Actions -->
    <button id="quick-run-btn" class="floating-action-btn" title="รันโค้ด (Ctrl+Enter)">
        <i class="fas fa-play"></i>
    </button>
    
    <div class="container mx-auto px-4 py-2 h-screen flex flex-col">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-4 py-3">
            <div class="flex items-center space-x-3 mb-3 md:mb-0">
                <div class="bg-gradient-to-br from-blue-600 to-purple-600 p-2 rounded-lg shadow-lg">
                    <i class="fas fa-code text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">Live Code Tester Pro</h1>
                    <p class="text-sm text-gray-500 dark:text-gray-400">ทดสอบโค้ดหลายภาษาแบบเรียลไทม์</p>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="flex flex-wrap gap-3 items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-sm hidden md:block">ภาษา:</span>
                    <div class="language-selector">
                        <button id="language-selector-btn" class="bg-gray-800 dark:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors shadow-md">
                            <i class="fab fa-html5 text-orange-500"></i>
                            <span id="current-language">HTML</span>
                            <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        <div id="language-dropdown" class="language-dropdown">
                            <div class="language-option active" data-lang="html">
                                <i class="fab fa-html5 mr-2 text-orange-500"></i>
                                <div>
                                    <div class="font-medium">HTML</div>
                                    <div class="text-xs text-gray-400">สำหรับเว็บเพจ</div>
                                </div>
                            </div>
                            <div class="language-option" data-lang="python">
                                <i class="fab fa-python mr-2 text-yellow-500"></i>
                                <div>
                                    <div class="font-medium">Python</div>
                                    <div class="text-xs text-gray-400">ภาษาสคริปต์</div>
                                </div>
                            </div>
                            <div class="language-option" data-lang="csharp">
                                <i class="fas fa-code mr-2 text-purple-500"></i>
                                <div>
                                    <div class="font-medium">C#</div>
                                    <div class="text-xs text-gray-400">Microsoft .NET</div>
                                </div>
                            </div>
                            <div class="language-option" data-lang="cpp">
                                <i class="fas fa-cog mr-2 text-blue-500"></i>
                                <div>
                                    <div class="font-medium">C++</div>
                                    <div class="text-xs text-gray-400">ภาษาเชิงระบบ</div>
                                </div>
                            </div>
                            <div class="language-option" data-lang="c">
                                <i class="fas fa-cog mr-2 text-blue-300"></i>
                                <div>
                                    <div class="font-medium">C</div>
                                    <div class="text-xs text-gray-400">ภาษาโปรแกรมพื้นฐาน</div>
                                </div>
                            </div>
                            <div class="language-option" data-lang="php">
                                <i class="fab fa-php mr-2 text-indigo-500"></i>
                                <div>
                                    <div class="font-medium">PHP</div>
                                    <div class="text-xs text-gray-400">เว็บเซิร์ฟเวอร์</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2">
                    <span class="text-sm hidden md:block">ธีม:</span>
                    <button id="theme-toggle" class="bg-gray-800 dark:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors shadow-md">
                        <i class="fas fa-moon"></i>
                        <span id="theme-text">ดาร์ก</span>
                    </button>
                </div>
                
                <div class="flex items-center space-x-2">
                    <span class="text-sm hidden md:block">อัปเดต:</span>
                    <div class="flex space-x-2">
                        <button id="live-toggle" class="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-green-700 transition-colors shadow-md">
                            <i class="fas fa-play"></i>
                            <span id="live-text">Live</span>
                        </button>
                        <button id="run-btn" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:from-blue-600 hover:to-blue-800 transition-all shadow-md run-button-animation">
                            <i class="fas fa-play-circle"></i>
                            <span>รันโค้ด</span>
                        </button>
                    </div>
                </div>
                
                <button id="download-btn" class="bg-gradient-to-r from-purple-500 to-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:from-purple-600 hover:to-purple-800 transition-all shadow-md">
                    <i class="fas fa-download"></i>
                    <span>ดาวน์โหลด</span>
                </button>
                
                <button id="reset-btn" class="bg-gradient-to-r from-red-500 to-red-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 hover:from-red-600 hover:to-red-800 transition-all shadow-md">
                    <i class="fas fa-trash-alt"></i>
                    <span>รีเซ็ต</span>
                </button>
            </div>
        </header>
        
        <!-- Live Indicator -->
        <div class="flex items-center justify-center mb-2">
            <div id="live-indicator" class="flex items-center space-x-2 bg-gradient-to-r from-green-900 to-green-700 text-green-200 px-4 py-2 rounded-lg shadow">
                <i class="fas fa-circle live-indicator"></i>
                <span id="live-status-text">อัปเดตแบบเรียลไทม์</span>
            </div>
        </div>
        
        <!-- Split View Container -->
        <div class="split-container">
            <!-- Editor Panel -->
            <div class="editor-section bg-gray-900 dark:bg-gray-800 rounded-lg border border-gray-700 relative shadow-lg">
                <div class="flex justify-between items-center bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-900 dark:to-gray-800 px-4 py-3 rounded-t-lg border-b border-gray-700">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-code text-green-400"></i>
                        <h2 class="font-bold" id="editor-title">HTML Editor</h2>
                        <span class="text-xs bg-blue-900 text-blue-200 px-2 py-1 rounded">Line Numbers: ON</span>
                        <div class="example-selector">
                            <button id="example-btn" class="example-btn">
                                <i class="fas fa-code-branch"></i> ตัวอย่างโค้ด
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="text-sm text-gray-400 hidden md:block">
                            <i class="fas fa-expand-arrows-alt mr-1"></i>
                            <span>ลากเส้นแบ่งเพื่อปรับขนาด</span>
                        </div>
                        <button id="fullscreen-btn" class="ml-2 bg-gray-700 text-white px-3 py-1.5 rounded-lg flex items-center space-x-2 hover:bg-gray-600 transition-colors">
                            <i class="fas fa-expand"></i>
                            <span class="hidden md:inline">เต็มจอ</span>
                        </button>
                    </div>
                </div>
                
                <div class="editor-wrapper">
                    <div id="line-numbers-container" class="line-numbers">
                        <!-- Line numbers will be generated here -->
                    </div>
                    <textarea id="code-editor" class="text-editor" spellcheck="false" placeholder="เริ่มต้นเขียนโค้ดที่นี่..."></textarea>
                </div>
                
                <!-- Resizer -->
                <div class="resizer"></div>
            </div>
            
            <!-- Preview Panel -->
            <div class="preview-section bg-gray-800 dark:bg-gray-700 rounded-lg border border-gray-700 shadow-lg">
                <div class="flex justify-between items-center bg-gradient-to-r from-gray-800 to-gray-900 dark:from-gray-900 dark:to-gray-800 px-4 py-3 rounded-t-lg border-b border-gray-700">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-eye text-blue-400"></i>
                        <h2 class="font-bold">ผลลัพธ์</h2>
                    </div>
                    <div class="flex items-center">
                        <div class="preview-modes">
                            <button id="preview-html" class="preview-mode-btn active">
                                <i class="fas fa-code"></i> HTML Preview
                            </button>
                            <button id="preview-console" class="preview-mode-btn">
                                <i class="fas fa-terminal"></i> Console
                            </button>
                            <button id="preview-screen" class="preview-mode-btn">
                                <i class="fas fa-desktop"></i> หน้าจอใหญ่
                            </button>
                        </div>
                        <div class="text-sm text-gray-400 ml-4">
                            <i class="fas fa-clock mr-1"></i>
                            <span>อัปเดตล่าสุด: <span id="last-update">-</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="flex-1 p-2 overflow-hidden">
                    <!-- Output Tabs -->
                    <div class="output-tabs">
                        <div class="output-tab active" data-tab="preview">Preview</div>
                        <div class="output-tab" data-tab="console">Console</div>
                        <div class="output-tab" data-tab="result">ผลการรัน</div>
                    </div>
                    
                    <!-- Output Contents -->
                    <div id="preview-content" class="output-content active h-full">
                        <iframe id="preview-frame" class="preview-frame" sandbox="allow-scripts allow-same-origin"></iframe>
                    </div>
                    
                    <div id="console-content" class="output-content h-full">
                        <div class="console-output">
                            <div class="console-line console-command">$ ระบบคอนโซลพร้อมใช้งาน</div>
                            <div class="console-line console-info">$ พิมพ์โค้ดในแถบด้านซ้าย แล้วคลิกปุ่ม "รันโค้ด"</div>
                            <div id="console-output-content"></div>
                        </div>
                    </div>
                    
                    <div id="result-content" class="output-content h-full">
                        <div class="console-output">
                            <div class="execution-result">
                                <div class="execution-header">
                                    <h4 class="font-bold text-lg">ผลการรันโค้ด</h4>
                                    <div class="execution-time" id="execution-time">-</div>
                                </div>
                                <div id="execution-result-content">
                                    <div class="console-line console-info">ยังไม่ได้รันโค้ด</div>
                                    <div class="console-line console-info">คลิกปุ่ม "รันโค้ด" เพื่อทดสอบโค้ดของคุณ</div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <h4 class="font-bold mb-2">สถิติ</h4>
                                <div class="grid grid-cols-2 gap-2 text-sm">
                                    <div class="bg-gray-800 p-2 rounded">
                                        <div class="text-gray-400">ภาษา</div>
                                        <div id="stat-language" class="font-medium">HTML</div>
                                    </div>
                                    <div class="bg-gray-800 p-2 rounded">
                                        <div class="text-gray-400">บรรทัด</div>
                                        <div id="stat-lines" class="font-medium">0</div>
                                    </div>
                                    <div class="bg-gray-800 p-2 rounded">
                                        <div class="text-gray-400">ขนาดไฟล์</div>
                                        <div id="stat-size" class="font-medium">0 KB</div>
                                    </div>
                                    <div class="bg-gray-800 p-2 rounded">
                                        <div class="text-gray-400">เวลารันล่าสุด</div>
                                        <div id="stat-last-run" class="font-medium">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-4 pt-3 border-t border-gray-700">
            <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                <div class="mb-2 md:mb-0 text-center md:text-left">
                    <p class="flex items-center">
                        <i class="fas fa-code mr-1"></i> Live Code Tester Pro - รองรับ HTML, Python, C#, C++, C, PHP
                    </p>
                </div>
                <div class="flex flex-wrap justify-center gap-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-keyboard"></i>
                        <span>กด <kbd class="px-2 py-1 bg-gray-800 rounded shadow">Ctrl+S</kbd> เพื่อบันทึก</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-bolt"></i>
                        <span>กด <kbd class="px-2 py-1 bg-gray-800 rounded shadow">Ctrl+Enter</kbd> เพื่อรันโค้ด</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-expand"></i>
                        <span>กด <kbd class="px-2 py-1 bg-gray-800 rounded shadow">F11</kbd> เพื่อเต็มจอ</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // เริ่มต้นแอปพลิเคชันเมื่อ DOM โหลดเสร็จ
        document.addEventListener('DOMContentLoaded', function() {
            // เก็บ reference ไปยัง element สำคัญ
            const codeEditor = document.getElementById('code-editor');
            const previewFrame = document.getElementById('preview-frame');
            const screenFrame = document.getElementById('screen-frame');
            const lineNumbersContainer = document.getElementById('line-numbers-container');
            const themeToggle = document.getElementById('theme-toggle');
            const themeText = document.getElementById('theme-text');
            const liveToggle = document.getElementById('live-toggle');
            const liveText = document.getElementById('live-text');
            const liveIndicator = document.getElementById('live-indicator');
            const liveStatusText = document.getElementById('live-status-text');
            const runBtn = document.getElementById('run-btn');
            const quickRunBtn = document.getElementById('quick-run-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const lastUpdateEl = document.getElementById('last-update');
            const resizer = document.querySelector('.resizer');
            const editorSection = document.querySelector('.editor-section');
            const previewSection = document.querySelector('.preview-section');
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationText = document.getElementById('notification-text');
            const notificationContent = document.getElementById('notification-content');
            const downloadModal = document.getElementById('download-modal');
            const filenameInput = document.getElementById('filename');
            const fileExtensionText = document.getElementById('file-extension');
            const confirmDownloadBtn = document.getElementById('confirm-download');
            const cancelDownloadBtn = document.getElementById('cancel-download');
            const screenModal = document.getElementById('screen-modal');
            const screenSizeDisplay = document.getElementById('screen-size-display');
            const closeScreenModal = document.getElementById('close-screen-modal');
            const mobileScreenBtn = document.getElementById('mobile-screen');
            const tabletScreenBtn = document.getElementById('tablet-screen');
            const desktopScreenBtn = document.getElementById('desktop-screen');
            const fullScreenBtn = document.getElementById('full-screen');
            const languageSelectorBtn = document.getElementById('language-selector-btn');
            const languageDropdown = document.getElementById('language-dropdown');
            const currentLanguageEl = document.getElementById('current-language');
            const editorTitle = document.getElementById('editor-title');
            const previewHtmlBtn = document.getElementById('preview-html');
            const previewScreenBtn = document.getElementById('preview-screen');
            const previewConsoleBtn = document.getElementById('preview-console');
            const consoleOutputContent = document.getElementById('console-output-content');
            const executionResultContent = document.getElementById('execution-result-content');
            const executionTime = document.getElementById('execution-time');
            const statLanguage = document.getElementById('stat-language');
            const statLines = document.getElementById('stat-lines');
            const statSize = document.getElementById('stat-size');
            const statLastRun = document.getElementById('stat-last-run');
            const exampleBtn = document.getElementById('example-btn');
            const outputTabs = document.querySelectorAll('.output-tab');
            const outputContents = document.querySelectorAll('.output-content');
            
            // ตัวแปรสถานะ
            let isLiveMode = true;
            let isDarkMode = true;
            let isResizing = false;
            let isFullscreen = false;
            let editorWidth = 50; // เปอร์เซ็นต์
            let currentLine = 1;
            let currentLanguage = 'html';
            let currentScreenSize = 'desktop';
            let isRunningCode = false;
            let runHistory = [];
            
            // ตัวอย่างโค้ดสำหรับแต่ละภาษา (ลดขนาดโค้ดตัวอย่างลงเนื่องจากจำกัดพื้นที่)
            const codeExamples = {
                html: `<!DOCTYPE html>
<html>
<head>
    <title>ตัวอย่าง HTML</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        h1 { color: blue; }
        .box { background: #f0f0f0; padding: 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>สวัสดี Live Code Tester Pro!</h1>
    <div class="box">
        <p>นี่คือตัวอย่างโค้ด HTML พื้นฐาน</p>
        <button onclick="alert('สวัสดีจาก Live Tester!')">คลิกทดสอบ</button>
    </div>
    <script>
        console.log("ระบบพร้อมใช้งาน");
    <\/script>
</body>
</html>`,
                
                python: `# โปรแกรม Python ตัวอย่าง
print("=" * 40)
print("โปรแกรมภาษา Python ตัวอย่าง")
print("=" * 40)

# ข้อมูลนักเรียน
students = [
    {"name": "สมชาย", "age": 18, "grades": [85, 90, 78]},
    {"name": "สมหญิง", "age": 17, "grades": [95, 92, 98]},
    {"name": "สมหมาย", "age": 19, "grades": [65, 70, 68]}
]

print("\\nข้อมูลนักเรียน:")
for student in students:
    avg = sum(student["grades"]) / len(student["grades"])
    print(f"{student['name']} (อายุ {student['age']} ปี) - เกรดเฉลี่ย: {avg:.2f}")

# Fibonacci
def fibonacci(n):
    a, b = 0, 1
    result = []
    for _ in range(n):
        result.append(a)
        a, b = b, a + b
    return result

print("\\nลำดับ Fibonacci 10 ตัวแรก:")
print(fibonacci(10))

print("\\nสิ้นสุดโปรแกรมตัวอย่าง")`,
                
                csharp: `using System;

namespace CodeTesterExample
{
    class Program
    {
        static void Main()
        {
            Console.WriteLine("========================================");
            Console.WriteLine("โปรแกรมภาษา C# ตัวอย่าง");
            Console.WriteLine("========================================\\n");
            
            // ข้อมูลนักเรียน
            string[] students = { "สมชาย", "สมหญิง", "สมหมาย" };
            int[] ages = { 18, 17, 19 };
            double[] averages = { 85.5, 92.0, 68.5 };
            
            Console.WriteLine("ข้อมูลนักเรียน:");
            for (int i = 0; i < students.Length; i++)
            {
                Console.WriteLine($"{students[i]} (อายุ {ages[i]} ปี) - เกรดเฉลี่ย: {averages[i]:F1}");
            }
            
            // Fibonacci
            Console.WriteLine("\\nลำดับ Fibonacci 10 ตัวแรก:");
            int a = 0, b = 1;
            for (int i = 0; i < 10; i++)
            {
                Console.Write($"{a} ");
                int temp = a;
                a = b;
                b = temp + b;
            }
            
            Console.WriteLine("\\n\\nสิ้นสุดโปรแกรมตัวอย่าง");
        }
    }
}`,
                
                cpp: `#include <iostream>
using namespace std;

int main() {
    cout << "========================================" << endl;
    cout << "โปรแกรมภาษา C++ ตัวอย่าง" << endl;
    cout << "========================================\\n" << endl;
    
    // ข้อมูลนักเรียน
    string students[] = {"สมชาย", "สมหญิง", "สมหมาย"};
    int ages[] = {18, 17, 19};
    double averages[] = {85.5, 92.0, 68.5};
    
    cout << "ข้อมูลนักเรียน:" << endl;
    for (int i = 0; i < 3; i++) {
        cout << students[i] << " (อายุ " << ages[i] << " ปี) - เกรดเฉลี่ย: " << averages[i] << endl;
    }
    
    // Fibonacci
    cout << "\\nลำดับ Fibonacci 10 ตัวแรก:" << endl;
    int a = 0, b = 1;
    for (int i = 0; i < 10; i++) {
        cout << a << " ";
        int temp = a;
        a = b;
        b = temp + b;
    }
    
    cout << "\\n\\nสิ้นสุดโปรแกรมตัวอย่าง" << endl;
    return 0;
}`,
                
                c: `#include <stdio.h>

int main() {
    printf("========================================\\n");
    printf("โปรแกรมภาษา C ตัวอย่าง\\n");
    printf("========================================\\n\\n");
    
    // ข้อมูลนักเรียน
    char* students[] = {"สมชาย", "สมหญิง", "สมหมาย"};
    int ages[] = {18, 17, 19};
    double averages[] = {85.5, 92.0, 68.5};
    
    printf("ข้อมูลนักเรียน:\\n");
    for (int i = 0; i < 3; i++) {
        printf("%s (อายุ %d ปี) - เกรดเฉลี่ย: %.1f\\n", students[i], ages[i], averages[i]);
    }
    
    // Fibonacci
    printf("\\nลำดับ Fibonacci 10 ตัวแรก:\\n");
    int a = 0, b = 1;
    for (int i = 0; i < 10; i++) {
        printf("%d ", a);
        int temp = a;
        a = b;
        b = temp + b;
    }
    
    printf("\\n\\nสิ้นสุดโปรแกรมตัวอย่าง\\n");
    return 0;
}`,
                
                php: `<?php
echo "========================================\\n";
echo "โปรแกรมภาษา PHP ตัวอย่าง\\n";
echo "========================================\\n\\n";

// ข้อมูลนักเรียน
$students = ["สมชาย", "สมหญิง", "สมหมาย"];
$ages = [18, 17, 19];
$averages = [85.5, 92.0, 68.5];

echo "ข้อมูลนักเรียน:\\n";
for ($i = 0; $i < count($students); $i++) {
    echo $students[$i] . " (อายุ " . $ages[$i] . " ปี) - เกรดเฉลี่ย: " . $averages[$i] . "\\n";
}

// Fibonacci
echo "\\nลำดับ Fibonacci 10 ตัวแรก:\\n";
$a = 0;
$b = 1;
for ($i = 0; $i < 10; $i++) {
    echo $a . " ";
    $temp = $a;
    $a = $b;
    $b = $temp + $b;
}

echo "\\n\\nสิ้นสุดโปรแกรมตัวอย่าง\\n";
?>`
            };
            
            // ขยายข้อมูลภาษา
            const languageInfo = {
                html: { 
                    name: "HTML", 
                    extension: ".html", 
                    icon: "fab fa-html5", 
                    color: "text-orange-500",
                    runner: "html" 
                },
                python: { 
                    name: "Python", 
                    extension: ".py", 
                    icon: "fab fa-python", 
                    color: "text-yellow-500",
                    runner: "console" 
                },
                csharp: { 
                    name: "C#", 
                    extension: ".cs", 
                    icon: "fas fa-code", 
                    color: "text-purple-500",
                    runner: "console" 
                },
                cpp: { 
                    name: "C++", 
                    extension: ".cpp", 
                    icon: "fas fa-cog", 
                    color: "text-blue-500",
                    runner: "console" 
                },
                c: { 
                    name: "C", 
                    extension: ".c", 
                    icon: "fas fa-cog", 
                    color: "text-blue-300",
                    runner: "console" 
                },
                php: { 
                    name: "PHP", 
                    extension: ".php", 
                    icon: "fab fa-php", 
                    color: "text-indigo-500",
                    runner: "console" 
                }
            };
            
            // ฟังก์ชันสำหรับแปลง HTML entities
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // โหลดโค้ดที่บันทึกไว้ (ถ้ามี)
            function loadSavedCode() {
                try {
                    const savedCode = localStorage.getItem(`codeTester_${currentLanguage}`);
                    if (savedCode) {
                        codeEditor.value = savedCode;
                        updatePreview();
                        updateLineNumbers();
                        updateStats();
                        showNotification('โหลดโค้ดสำเร็จ', `โหลดโค้ด ${languageInfo[currentLanguage].name} ที่บันทึกไว้`, 'success');
                    } else {
                        // ถ้าไม่มีโค้ดที่บันทึกไว้ ให้ใช้ตัวอย่างโค้ด
                        codeEditor.value = codeExamples[currentLanguage];
                        updateLineNumbers();
                        updatePreview();
                        updateStats();
                    }
                } catch (e) {
                    console.error('Error loading saved code:', e);
                }
            }
            
            // อัปเดต preview
            function updatePreview() {
                try {
                    const code = codeEditor.value;
                    
                    if (currentLanguage === 'html') {
                        // สำหรับ HTML ให้แสดงใน iframe
                        const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
                        previewDoc.open();
                        previewDoc.write(code);
                        previewDoc.close();
                        
                        // อัปเดตหน้าจอใหญ่ด้วย (ถ้ากำลังแสดงอยู่)
                        const screenDoc = screenFrame.contentDocument || screenFrame.contentWindow.document;
                        if (screenDoc && screenDoc.readyState === 'complete') {
                            screenDoc.open();
                            screenDoc.write(code);
                            screenDoc.close();
                        }
                    } else {
                        // สำหรับภาษาอื่นๆ ให้แสดงในคอนโซล
                        updateConsoleOutput();
                    }
                    
                    // อัปเดตเวลาล่าสุด
                    const now = new Date();
                    lastUpdateEl.textContent = now.toLocaleTimeString('th-TH');
                    
                    // บันทึกลง localStorage
                    localStorage.setItem(`codeTester_${currentLanguage}`, code);
                    
                    // อัปเดตสถิติ
                    updateStats();
                    
                    // แสดงการแจ้งเตือนถ้าไม่ได้อยู่ในโหมด live
                    if (!isLiveMode) {
                        showNotification('อัปเดตสำเร็จ', 'อัปเดต preview เรียบร้อยแล้ว', 'success');
                    }
                } catch (e) {
                    console.error('Error updating preview:', e);
                    showNotification('เกิดข้อผิดพลาด', 'ไม่สามารถอัปเดต preview ได้', 'error');
                }
            }
            
            // อัปเดตคอนโซล output
            function updateConsoleOutput() {
                const code = codeEditor.value;
                consoleOutputContent.innerHTML = '';
                
                // เพิ่มข้อความเริ่มต้น
                consoleOutputContent.innerHTML += `
                    <div class="console-line console-command">$ โค้ดภาษา ${languageInfo[currentLanguage].name}</div>
                    <div class="console-line console-info">$ พิมพ์โค้ดด้านซ้ายและคลิก "รันโค้ด" เพื่อทดสอบ</div>
                    <div class="console-line console-info">$ รองรับการรันโค้ดแบบจำลองสำหรับทุกภาษา</div>
                `;
                
                // แสดงโค้ดที่เขียน
                consoleOutputContent.innerHTML += `
                    <div class="console-line console-output-text" style="margin-top: 1rem; white-space: pre-wrap; background: #1e293b; padding: 1rem; border-radius: 0.375rem; font-family: monospace;">
                        ${escapeHtml(code)}
                    </div>
                `;
            }
            
            // รันโค้ด
            async function runCode() {
                if (isRunningCode) return;
                
                isRunningCode = true;
                const startTime = new Date();
                const code = codeEditor.value;
                
                // แสดงสถานะการรัน
                runBtn.innerHTML = '<div class="loading"></div> รันโค้ด...';
                runBtn.classList.remove('run-button-animation');
                
                try {
                    // เปลี่ยนไปที่แท็บผลการรัน
                    switchTab('result');
                    
                    // ล้างผลลัพธ์เก่า
                    executionResultContent.innerHTML = '';
                    
                    // เพิ่มข้อความเริ่มต้น
                    executionResultContent.innerHTML += `
                        <div class="console-line console-command">$ เริ่มรันโค้ดภาษา ${languageInfo[currentLanguage].name}</div>
                        <div class="console-line console-info">$ เวลาเริ่มต้น: ${startTime.toLocaleTimeString('th-TH')}</div>
                        <div class="console-line console-info">$ จำนวนบรรทัด: ${code.split('\n').length}</div>
                    `;
                    
                    // จำลองการรันโค้ด
                    await simulateCodeExecution(code, currentLanguage);
                    
                    const endTime = new Date();
                    const executionTimeMs = endTime - startTime;
                    
                    // แสดงผลลัพธ์การรัน
                    executionResultContent.innerHTML += `
                        <div class="console-line console-success" style="margin-top: 1rem;">
                            $ การรันโค้ดสำเร็จเรียบร้อย!
                        </div>
                        <div class="console-line console-info">
                            $ ใช้เวลาในการรัน: ${executionTimeMs} มิลลิวินาที
                        </div>
                        <div class="console-line console-info">
                            $ เวลาสิ้นสุด: ${endTime.toLocaleTimeString('th-TH')}
                        </div>
                    `;
                    
                    // อัปเดตเวลาการรัน
                    executionTime.textContent = `${executionTimeMs}ms`;
                    statLastRun.textContent = endTime.toLocaleTimeString('th-TH');
                    
                    // บันทึกประวัติการรัน
                    runHistory.push({
                        language: currentLanguage,
                        timestamp: endTime,
                        executionTime: executionTimeMs,
                        success: true
                    });
                    
                    // อัปเดต console output ด้วย
                    updateConsoleOutput();
                    consoleOutputContent.innerHTML += `
                        <div class="console-line console-success" style="margin-top: 1rem;">
                            $ การรันโค้ดเสร็จสิ้น (${executionTimeMs}ms)
                        </div>
                    `;
                    
                    showNotification('รันโค้ดสำเร็จ', `รันโค้ด ${languageInfo[currentLanguage].name} เสร็จสิ้นใน ${executionTimeMs}ms`, 'success');
                    
                } catch (error) {
                    console.error('Error running code:', error);
                    
                    executionResultContent.innerHTML += `
                        <div class="console-line console-error" style="margin-top: 1rem;">
                            $ เกิดข้อผิดพลาดในการรันโค้ด: ${error.message}
                        </div>
                        <div class="console-line console-warning">
                            $ โปรดตรวจสอบไวยากรณ์ของโค้ด
                        </div>
                    `;
                    
                    showNotification('เกิดข้อผิดพลาด', 'ไม่สามารถรันโค้ดได้', 'error');
                    
                } finally {
                    // คืนสถานะปุ่มรันโค้ด
                    isRunningCode = false;
                    runBtn.innerHTML = '<i class="fas fa-play-circle"></i> รันโค้ด';
                    runBtn.classList.add('run-button-animation');
                    
                    // อัปเดตสถิติ
                    updateStats();
                }
            }
            
            // จำลองการรันโค้ด
            function simulateCodeExecution(code, language) {
                return new Promise((resolve, reject) => {
                    try {
                        // เพิ่มความล่าช้าเพื่อจำลองการรันโค้ด
                        setTimeout(() => {
                            // จำลองผลลัพธ์ตามภาษา
                            let output = '';
                            
                            if (language === 'python') {
                                output = `
                                    ========================================
                                    โปรแกรมภาษา Python ตัวอย่าง
                                    ========================================
                                    
                                    ข้อมูลนักเรียน:
                                    สมชาย (อายุ 18 ปี) - เกรดเฉลี่ย: 84.33
                                    สมหญิง (อายุ 17 ปี) - เกรดเฉลี่ย: 95.00
                                    สมหมาย (อายุ 19 ปี) - เกรดเฉลี่ย: 67.67
                                    
                                    ลำดับ Fibonacci 10 ตัวแรก:
                                    [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
                                    
                                    สิ้นสุดโปรแกรมตัวอย่าง
                                `;
                            } else if (language === 'csharp') {
                                output = `
                                    ========================================
                                    โปรแกรมภาษา C# ตัวอย่าง
                                    ========================================
                                    
                                    ข้อมูลนักเรียน:
                                    สมชาย (อายุ 18 ปี) - เกรดเฉลี่ย: 85.5
                                    สมหญิง (อายุ 17 ปี) - เกรดเฉลี่ย: 92.0
                                    สมหมาย (อายุ 19 ปี) - เกรดเฉลี่ย: 68.5
                                    
                                    ลำดับ Fibonacci 10 ตัวแรก:
                                    0 1 1 2 3 5 8 13 21 34
                                    
                                    สิ้นสุดโปรแกรมตัวอย่าง
                                `;
                            } else if (language === 'cpp') {
                                output = `
                                    ========================================
                                    โปรแกรมภาษา C++ ตัวอย่าง
                                    ========================================
                                    
                                    ข้อมูลนักเรียน:
                                    สมชาย (อายุ 18 ปี) - เกรดเฉลี่ย: 85.5
                                    สมหญิง (อายุ 17 ปี) - เกรดเฉลี่ย: 92
                                    สมหมาย (อายุ 19 ปี) - เกรดเฉลี่ย: 68.5
                                    
                                    ลำดับ Fibonacci 10 ตัวแรก:
                                    0 1 1 2 3 5 8 13 21 34
                                    
                                    สิ้นสุดโปรแกรมตัวอย่าง
                                `;
                            } else if (language === 'c') {
                                output = `
                                    ========================================
                                    โปรแกรมภาษา C ตัวอย่าง
                                    ========================================
                                    
                                    ข้อมูลนักเรียน:
                                    สมชาย (อายุ 18 ปี) - เกรดเฉลี่ย: 85.5
                                    สมหญิง (อายุ 17 ปี) - เกรดเฉลี่ย: 92.0
                                    สมหมาย (อายุ 19 ปี) - เกรดเฉลี่ย: 68.5
                                    
                                    ลำดับ Fibonacci 10 ตัวแรก:
                                    0 1 1 2 3 5 8 13 21 34
                                    
                                    สิ้นสุดโปรแกรมตัวอย่าง
                                `;
                            } else if (language === 'php') {
                                output = `
                                    ========================================
                                    โปรแกรมภาษา PHP ตัวอย่าง
                                    ========================================
                                    
                                    ข้อมูลนักเรียน:
                                    สมชาย (อายุ 18 ปี) - เกรดเฉลี่ย: 85.5
                                    สมหญิง (อายุ 17 ปี) - เกรดเฉลี่ย: 92
                                    สมหมาย (อายุ 19 ปี) - เกรดเฉลี่ย: 68.5
                                    
                                    ลำดับ Fibonacci 10 ตัวแรก:
                                    0 1 1 2 3 5 8 13 21 34
                                    
                                    สิ้นสุดโปรแกรมตัวอย่าง
                                `;
                            } else {
                                output = 'ภาษาไม่รองรับการรันในระบบจำลอง';
                            }
                            
                            // เพิ่มผลลัพธ์ลงใน execution result
                            executionResultContent.innerHTML += `
                                <div class="console-line console-info" style="margin-top: 1rem;">$ ผลลัพธ์การรันโค้ด:</div>
                                <div class="console-output-text" style="background: #1e293b; padding: 1rem; border-radius: 0.375rem; margin-top: 0.5rem; font-family: monospace; white-space: pre-wrap;">
                                    ${escapeHtml(output)}
                                </div>
                            `;
                            
                            resolve();
                        }, 800); // ล่าช้า 0.8 วินาทีเพื่อจำลองการรันโค้ด
                    } catch (error) {
                        reject(error);
                    }
                });
            }
            
            // อัปเดตสถิติ
            function updateStats() {
                const code = codeEditor.value;
                const lines = code.split('\n').length;
                const size = new Blob([code]).size;
                
                statLanguage.textContent = languageInfo[currentLanguage].name;
                statLines.textContent = lines;
                statSize.textContent = `${(size / 1024).toFixed(2)} KB`;
                
                if (runHistory.length > 0) {
                    const lastRun = runHistory[runHistory.length - 1];
                    statLastRun.textContent = lastRun.timestamp.toLocaleTimeString('th-TH');
                }
            }
            
            // เปลี่ยนภาษา
            function changeLanguage(lang) {
                if (lang === currentLanguage) return;
                
                // บันทึกโค้ดปัจจุบันก่อนเปลี่ยนภาษา
                localStorage.setItem(`codeTester_${currentLanguage}`, codeEditor.value);
                
                // อัปเดตภาษาใหม่
                currentLanguage = lang;
                const langInfo = languageInfo[lang];
                
                // อัปเดต UI
                currentLanguageEl.textContent = langInfo.name;
                editorTitle.textContent = `${langInfo.name} Editor`;
                
                // อัปเดตไอคอนและสี
                languageSelectorBtn.innerHTML = `
                    <i class="${langInfo.icon} ${langInfo.color}"></i>
                    <span>${langInfo.name}</span>
                    <i class="fas fa-chevron-down ml-1"></i>
                `;
                
                // อัปเดตตัวเลือกใน dropdown
                document.querySelectorAll('.language-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.dataset.lang === lang) {
                        option.classList.add('active');
                    }
                });
                
                // โหลดโค้ดสำหรับภาษาใหม่
                loadSavedCode();
                
                // อัปเดตชื่อไฟล์ดาวน์โหลด
                filenameInput.value = `my-code${langInfo.extension}`;
                fileExtensionText.textContent = `ไฟล์จะถูกดาวน์โหลดเป็นไฟล์ ${langInfo.extension}`;
                
                // อัปเดต preview mode
                if (lang === 'html') {
                    switchTab('preview');
                } else {
                    switchTab('console');
                }
                
                showNotification('เปลี่ยนภาษา', `เปลี่ยนภาษาเป็น ${langInfo.name}`, 'success');
            }
            
            // เปลี่ยนแท็บ
            function switchTab(tabName) {
                // อัปเดตปุ่มแท็บ
                outputTabs.forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active');
                    }
                });
                
                // อัปเดตเนื้อหา
                outputContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabName}-content`) {
                        content.classList.add('active');
                    }
                });
            }
            
            // แสดงหน้าจอใหญ่
            function showScreenModal() {
                screenModal.classList.add('show');
                
                // อัปเดตขนาดหน้าจอเริ่มต้น
                updateScreenSize('desktop');
            }
            
            // อัปเดตขนาดหน้าจอ
            function updateScreenSize(size) {
                currentScreenSize = size;
                
                // อัปเดตปุ่ม
                mobileScreenBtn.classList.remove('active');
                tabletScreenBtn.classList.remove('active');
                desktopScreenBtn.classList.remove('active');
                fullScreenBtn.classList.remove('active');
                
                // ตั้งค่าขนาด
                const screenBody = document.querySelector('.screen-modal-body');
                const screenFrame = document.getElementById('screen-frame');
                
                if (size === 'mobile') {
                    mobileScreenBtn.classList.add('active');
                    screenBody.style.maxWidth = '375px';
                    screenBody.style.margin = '0 auto';
                    screenFrame.style.width = '375px';
                    screenFrame.style.height = '667px';
                    screenSizeDisplay.textContent = 'ขนาด: มือถือ (375x667)';
                } else if (size === 'tablet') {
                    tabletScreenBtn.classList.add('active');
                    screenBody.style.maxWidth = '768px';
                    screenBody.style.margin = '0 auto';
                    screenFrame.style.width = '768px';
                    screenFrame.style.height = '1024px';
                    screenSizeDisplay.textContent = 'ขนาด: แท็บเล็ต (768x1024)';
                } else if (size === 'desktop') {
                    desktopScreenBtn.classList.add('active');
                    screenBody.style.maxWidth = '100%';
                    screenBody.style.margin = '0';
                    screenFrame.style.width = '100%';
                    screenFrame.style.height = '100%';
                    screenSizeDisplay.textContent = 'ขนาด: เดสก์ท็อป (100%)';
                } else if (size === 'full') {
                    fullScreenBtn.classList.add('active');
                    screenBody.style.maxWidth = '100%';
                    screenBody.style.margin = '0';
                    screenFrame.style.width = '100%';
                    screenFrame.style.height = '100%';
                    screenSizeDisplay.textContent = 'ขนาด: เต็มจอ';
                }
                
                // อัปเดต iframe
                try {
                    const code = codeEditor.value;
                    const screenDoc = screenFrame.contentDocument || screenFrame.contentWindow.document;
                    screenDoc.open();
                    screenDoc.write(code);
                    screenDoc.close();
                } catch (e) {
                    console.error('Error updating screen frame:', e);
                }
            }
            
            // สลับโหมดธีม
            function toggleTheme() {
                const htmlElement = document.documentElement;
                isDarkMode = !isDarkMode;
                
                if (isDarkMode) {
                    htmlElement.classList.add('dark');
                    themeText.textContent = 'ดาร์ก';
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>ดาร์ก</span>';
                    themeToggle.classList.remove('bg-gray-200', 'text-gray-800');
                    themeToggle.classList.add('bg-gray-800', 'text-white');
                    showNotification('เปลี่ยนธีม', 'เปลี่ยนเป็นธีมดาร์กโหมด', 'success');
                } else {
                    htmlElement.classList.remove('dark');
                    themeText.textContent = 'ไลต์';
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>ไลต์</span>';
                    themeToggle.classList.remove('bg-gray-800', 'text-white');
                    themeToggle.classList.add('bg-gray-200', 'text-gray-800');
                    showNotification('เปลี่ยนธีม', 'เปลี่ยนเป็นธีมไลต์โหมด', 'success');
                }
                
                // บันทึกการตั้งค่า
                localStorage.setItem('codeTesterTheme', isDarkMode ? 'dark' : 'light');
            }
            
            // สลับโหมด live update
            function toggleLiveMode() {
                isLiveMode = !isLiveMode;
                
                if (isLiveMode) {
                    liveText.textContent = 'Live';
                    liveStatusText.textContent = 'อัปเดตแบบเรียลไทม์';
                    liveToggle.innerHTML = '<i class="fas fa-play"></i><span>Live</span>';
                    liveToggle.classList.remove('bg-gray-600');
                    liveToggle.classList.add('bg-green-600');
                    liveIndicator.classList.remove('bg-gray-800', 'text-gray-400');
                    liveIndicator.classList.add('bg-green-900', 'text-green-200');
                    showNotification('อัปเดตแบบเรียลไทม์', 'เปิดโหมดอัปเดตแบบเรียลไทม์แล้ว', 'success');
                } else {
                    liveText.textContent = 'Paused';
                    liveStatusText.textContent = 'หยุดอัปเดตชั่วคราว';
                    liveToggle.innerHTML = '<i class="fas fa-pause"></i><span>Paused</span>';
                    liveToggle.classList.remove('bg-green-600');
                    liveToggle.classList.add('bg-gray-600');
                    liveIndicator.classList.remove('bg-green-900', 'text-green-200');
                    liveIndicator.classList.add('bg-gray-800', 'text-gray-400');
                    showNotification('หยุดอัปเดตชั่วคราว', 'ปิดโหมดอัปเดตแบบเรียลไทม์แล้ว', 'warning');
                }
            }
            
            // สลับโหมดเต็มจอ
            function toggleFullscreen() {
                isFullscreen = !isFullscreen;
                
                if (isFullscreen) {
                    editorSection.classList.add('fullscreen');
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i><span class="hidden md:inline">ย่อ</span>';
                    fullscreenBtn.classList.remove('bg-gray-700');
                    fullscreenBtn.classList.add('bg-yellow-600');
                    
                    // ซ่อน preview section
                    previewSection.style.display = 'none';
                    resizer.style.display = 'none';
                    
                    // อัปเดต line numbers สำหรับ fullscreen
                    updateLineNumbers();
                    
                    showNotification('โหมดเต็มจอ', 'เปิดโหมดเต็มจอแล้ว - กด ESC เพื่อออก', 'info');
                } else {
                    editorSection.classList.remove('fullscreen');
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i><span class="hidden md:inline">เต็มจอ</span>';
                    fullscreenBtn.classList.remove('bg-yellow-600');
                    fullscreenBtn.classList.add('bg-gray-700');
                    
                    // แสดง preview section
                    previewSection.style.display = 'flex';
                    resizer.style.display = 'block';
                    
                    // อัปเดต line numbers กลับสู่ปกติ
                    updateLineNumbers();
                    
                    showNotification('โหมดปกติ', 'ปิดโหมดเต็มจอแล้ว', 'success');
                }
            }
            
            // รีเซ็ตโค้ดเป็นค่าเริ่มต้น
            function resetCode() {
                showCustomConfirm(
                    'รีเซ็ตโค้ด',
                    `คุณแน่ใจที่จะรีเซ็ตโค้ด ${languageInfo[currentLanguage].name} ทั้งหมด? การเปลี่ยนแปลงทั้งหมดจะหายไป`,
                    function() {
                        codeEditor.value = codeExamples[currentLanguage];
                        updateLineNumbers();
                        updatePreview();
                        updateStats();
                        showNotification('รีเซ็ตสำเร็จ', `รีเซ็ตโค้ด ${languageInfo[currentLanguage].name} เป็นค่าเริ่มต้นแล้ว`, 'success');
                    }
                );
            }
            
            // แสดง modal ดาวน์โหลด
            function showDownloadModal() {
                downloadModal.classList.add('show');
                filenameInput.focus();
                filenameInput.select();
            }
            
            // ซ่อน modal ดาวน์โหลด
            function hideDownloadModal() {
                downloadModal.classList.remove('show');
            }
            
            // ดาวน์โหลดไฟล์โค้ด
            function downloadCode() {
                const content = codeEditor.value;
                const filename = filenameInput.value || `my-code${languageInfo[currentLanguage].extension}`;
                
                // สร้าง Blob จากเนื้อหา
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                // สร้าง element a สำหรับดาวน์โหลด
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                
                // ล้างทรัพยากร
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                hideDownloadModal();
                showNotification('ดาวน์โหลดสำเร็จ', `ดาวน์โหลดไฟล์ "${filename}" เรียบร้อยแล้ว`, 'success');
            }
            
            // แสดงการแจ้งเตือนแบบสวยงาม
            function showNotification(title, message, type = 'success') {
                // ตั้งค่าชื่อเรื่องและข้อความ
                notificationTitle.textContent = title;
                notificationText.textContent = message;
                
                // ตั้งค่าสีตามประเภท
                notificationContent.className = 'notification-content';
                if (type === 'success') {
                    notificationContent.classList.add('notification-success');
                } else if (type === 'error') {
                    notificationContent.classList.add('notification-error');
                } else if (type === 'warning') {
                    notificationContent.classList.add('notification-warning');
                } else if (type === 'info') {
                    notificationContent.classList.add('notification-info');
                }
                
                // แสดงการแจ้งเตือน
                notification.classList.add('show');
                
                // ซ่อนการแจ้งเตือนหลังจาก 4 วินาที
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }
            
            // แสดงการยืนยันแบบสวยงามแทน confirm
            function showCustomConfirm(title, message, onConfirm) {
                const confirmModal = document.createElement('div');
                confirmModal.className = 'modal show';
                confirmModal.innerHTML = `
                    <div class="modal-content">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i> ${escapeHtml(title)}
                        </h3>
                        <div class="mb-6">
                            <p class="text-gray-300">${escapeHtml(message)}</p>
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button id="custom-cancel" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition-colors">
                                ยกเลิก
                            </button>
                            <button id="custom-confirm" class="px-4 py-2 bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
                                ตกลง
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmModal);
                
                // จัดการเหตุการณ์
                document.getElementById('custom-cancel').addEventListener('click', function() {
                    document.body.removeChild(confirmModal);
                });
                
                document.getElementById('custom-confirm').addEventListener('click', function() {
                    document.body.removeChild(confirmModal);
                    onConfirm();
                });
                
                // ปิดเมื่อคลิกภายนอก
                confirmModal.addEventListener('click', function(e) {
                    if (e.target === confirmModal) {
                        document.body.removeChild(confirmModal);
                    }
                });
            }
            
            // ตั้งค่า resizer
            function setupResizer() {
                resizer.addEventListener('mousedown', function(e) {
                    isResizing = true;
                    resizer.classList.add('active');
                    document.body.style.cursor = 'col-resize';
                    e.preventDefault();
                });
                
                document.addEventListener('mousemove', function(e) {
                    if (!isResizing) return;
                    
                    const containerWidth = document.querySelector('.split-container').offsetWidth;
                    const mouseX = e.clientX;
                    const containerLeft = document.querySelector('.split-container').getBoundingClientRect().left;
                    
                    // คำนวณเปอร์เซ็นต์ความกว้าง
                    editorWidth = ((mouseX - containerLeft) / containerWidth) * 100;
                    
                    // จำกัดขนาดขั้นต่ำและสูงสุด
                    if (editorWidth < 20) editorWidth = 20;
                    if (editorWidth > 80) editorWidth = 80;
                    
                    // อัปเดตขนาด
                    editorSection.style.width = `${editorWidth}%`;
                    previewSection.style.width = `${100 - editorWidth}%`;
                });
                
                document.addEventListener('mouseup', function() {
                    if (isResizing) {
                        isResizing = false;
                        resizer.classList.remove('active');
                        document.body.style.cursor = '';
                        
                        // บันทึกขนาดที่ปรับ
                        localStorage.setItem('codeTesterEditorWidth', editorWidth);
                    }
                });
                
                // โหลดขนาดที่บันทึกไว้
                const savedWidth = localStorage.getItem('codeTesterEditorWidth');
                if (savedWidth) {
                    editorWidth = parseFloat(savedWidth);
                    editorSection.style.width = `${editorWidth}%`;
                    previewSection.style.width = `${100 - editorWidth}%`;
                }
            }
            
            // อัปเดต line numbers
            function updateLineNumbers() {
                const lines = codeEditor.value.split('\n').length;
                const scrollTop = codeEditor.scrollTop;
                const lineHeight = 21; // ควรตรงกับ line-height ใน CSS
                
                // ล้าง line numbers เก่า
                lineNumbersContainer.innerHTML = '';
                
                // สร้าง line numbers ใหม่
                for (let i = 1; i <= Math.max(lines, 30); i++) {
                    const lineNumber = document.createElement('div');
                    lineNumber.className = 'line-number';
                    lineNumber.textContent = i;
                    lineNumber.dataset.line = i;
                    
                    // ไฮไลต์บรรทัดปัจจุบัน
                    if (i === currentLine) {
                        lineNumber.classList.add('current-line');
                    }
                    
                    // คลิกเพื่อไปยังบรรทัดนั้น
                    lineNumber.addEventListener('click', function() {
                        goToLine(i);
                    });
                    
                    lineNumbersContainer.appendChild(lineNumber);
                }
                
                // ซิงค์การเลื่อน
                lineNumbersContainer.scrollTop = scrollTop;
            }
            
            // ไปยังบรรทัดที่ระบุ
            function goToLine(lineNumber) {
                const lines = codeEditor.value.split('\n');
                if (lineNumber < 1 || lineNumber > lines.length) return;
                
                // คำนวณตำแหน่ง
                const lineHeight = 21;
                const targetPosition = (lineNumber - 1) * lineHeight;
                
                // เลื่อน editor ไปยังตำแหน่งนั้น
                codeEditor.scrollTop = targetPosition;
                
                // ตั้งค่าเคอร์เซอร์ไปยังต้นบรรทัด
                let charIndex = 0;
                for (let i = 0; i < lineNumber - 1; i++) {
                    charIndex += lines[i].length + 1; // +1 สำหรับ newline
                }
                
                codeEditor.focus();
                codeEditor.setSelectionRange(charIndex, charIndex);
                
                // อัปเดต current line และไฮไลต์
                currentLine = lineNumber;
                updateLineNumbers();
                
                // ไฮไลต์บรรทัดชั่วคราว
                const lineElement = lineNumbersContainer.querySelector(`[data-line="${lineNumber}"]`);
                if (lineElement) {
                    lineElement.classList.add('highlight');
                    setTimeout(() => {
                        lineElement.classList.remove('highlight');
                    }, 1000);
                }
                
                showNotification('ไปยังบรรทัด', `ไปยังบรรทัดที่ ${lineNumber}`, 'info');
            }
            
            // ตรวจจับบรรทัดปัจจุบันจากตำแหน่งเคอร์เซอร์
            function detectCurrentLine() {
                const cursorPosition = codeEditor.selectionStart;
                const textBeforeCursor = codeEditor.value.substring(0, cursorPosition);
                const lines = textBeforeCursor.split('\n');
                currentLine = lines.length;
                updateLineNumbers();
            }
            
            // ตั้งค่า keyboard shortcuts
            function setupKeyboardShortcuts() {
                document.addEventListener('keydown', function(e) {
                    // Ctrl+S เพื่อบันทึก
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        localStorage.setItem(`codeTester_${currentLanguage}`, codeEditor.value);
                        showNotification('บันทึกสำเร็จ', 'บันทึกโค้ดเรียบร้อยแล้ว', 'success');
                    }
                    
                    // Ctrl+Enter หรือ Ctrl+R เพื่อรันโค้ด
                    if ((e.ctrlKey || e.metaKey) && (e.key === 'Enter' || e.key === 'r')) {
                        e.preventDefault();
                        runCode();
                    }
                    
                    // Ctrl+D เพื่อสลับธีม
                    if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                        e.preventDefault();
                        toggleTheme();
                    }
                    
                    // Ctrl+L เพื่อสลับโหมด live
                    if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                        e.preventDefault();
                        toggleLiveMode();
                    }
                    
                    // Ctrl+E เพื่อสลับเต็มจอ
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    
                    // Ctrl+G เพื่อไปยังบรรทัด
                    if ((e.ctrlKey || e.metaKey) && e.key === 'g') {
                        e.preventDefault();
                        const line = prompt('ไปยังบรรทัดที่:');
                        if (line && !isNaN(line)) {
                            goToLine(parseInt(line));
                        }
                    }
                    
                    // Ctrl+1-6 เพื่อเปลี่ยนภาษา
                    if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '6') {
                        e.preventDefault();
                        const langIndex = parseInt(e.key) - 1;
                        const langs = ['html', 'python', 'csharp', 'cpp', 'c', 'php'];
                        if (langs[langIndex]) {
                            changeLanguage(langs[langIndex]);
                        }
                    }
                    
                    // F11 สำหรับเต็มจอ
                    if (e.key === 'F11') {
                        e.preventDefault();
                        toggleFullscreen();
                    }
                    
                    // ESC เพื่อออกจากเต็มจอ
                    if (e.key === 'Escape' && isFullscreen) {
                        toggleFullscreen();
                    }
                    
                    // ESC เพื่อปิด modal
                    if (e.key === 'Escape') {
                        if (screenModal.classList.contains('show')) {
                            screenModal.classList.remove('show');
                        }
                        if (downloadModal.classList.contains('show')) {
                            hideDownloadModal();
                        }
                    }
                });
                
                // ตรวจจับการเลื่อนเมาส์และการกดคีย์ใน editor
                codeEditor.addEventListener('click', detectCurrentLine);
                codeEditor.addEventListener('keyup', detectCurrentLine);
                codeEditor.addEventListener('scroll', function() {
                    lineNumbersContainer.scrollTop = codeEditor.scrollTop;
                });
            }
            
            // ตั้งค่า event listeners
            function setupEventListeners() {
                // Live update เมื่อพิมพ์ใน editor
                codeEditor.addEventListener('input', function() {
                    updateLineNumbers();
                    updateStats();
                    if (isLiveMode) {
                        updatePreview();
                    }
                });
                
                // ปุ่มรันโค้ด
                runBtn.addEventListener('click', runCode);
                quickRunBtn.addEventListener('click', runCode);
                
                // ปุ่มสลับธีม
                themeToggle.addEventListener('click', toggleTheme);
                
                // ปุ่มสลับโหมด live
                liveToggle.addEventListener('click', toggleLiveMode);
                
                // ปุ่มเต็มจอ
                fullscreenBtn.addEventListener('click', toggleFullscreen);
                
                // ปุ่มรีเซ็ต
                resetBtn.addEventListener('click', resetCode);
                
                // ปุ่มดาวน์โหลด
                downloadBtn.addEventListener('click', showDownloadModal);
                
                // ปุ่มยืนยันดาวน์โหลด
                confirmDownloadBtn.addEventListener('click', downloadCode);
                
                // ปุ่มยกเลิกดาวน์โหลด
                cancelDownloadBtn.addEventListener('click', hideDownloadModal);
                
                // ปิด modal เมื่อคลิกภายนอก
                downloadModal.addEventListener('click', function(e) {
                    if (e.target === downloadModal) {
                        hideDownloadModal();
                    }
                });
                
                // ดาวน์โหลดเมื่อกด Enter ในช่องชื่อไฟล์
                filenameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        downloadCode();
                    }
                });
                
                // Language selector
                languageSelectorBtn.addEventListener('click', function() {
                    languageDropdown.classList.toggle('show');
                });
                
                // เลือกภาษา
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const lang = this.dataset.lang;
                        changeLanguage(lang);
                        languageDropdown.classList.remove('show');
                    });
                });
                
                // ปิด language dropdown เมื่อคลิกภายนอก
                document.addEventListener('click', function(e) {
                    if (!languageSelectorBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                        languageDropdown.classList.remove('show');
                    }
                });
                
                // ตัวอย่างโค้ด
                exampleBtn.addEventListener('click', function() {
                    codeEditor.value = codeExamples[currentLanguage];
                    updateLineNumbers();
                    updatePreview();
                    updateStats();
                    showNotification('โหลดตัวอย่าง', `โหลดตัวอย่างโค้ด ${languageInfo[currentLanguage].name}`, 'success');
                });
                
                // Output tabs
                outputTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabName = this.dataset.tab;
                        switchTab(tabName);
                    });
                });
                
                // Preview mode buttons
                previewHtmlBtn.addEventListener('click', function() {
                    switchTab('preview');
                });
                
                previewConsoleBtn.addEventListener('click', function() {
                    switchTab('console');
                });
                
                previewScreenBtn.addEventListener('click', function() {
                    showScreenModal();
                });
                
                // Screen modal
                closeScreenModal.addEventListener('click', function() {
                    screenModal.classList.remove('show');
                });
                
                mobileScreenBtn.addEventListener('click', function() {
                    updateScreenSize('mobile');
                });
                
                tabletScreenBtn.addEventListener('click', function() {
                    updateScreenSize('tablet');
                });
                
                desktopScreenBtn.addEventListener('click', function() {
                    updateScreenSize('desktop');
                });
                
                fullScreenBtn.addEventListener('click', function() {
                    updateScreenSize('full');
                });
                
                // ปิด screen modal เมื่อคลิกภายนอก
                screenModal.addEventListener('click', function(e) {
                    if (e.target === screenModal) {
                        screenModal.classList.remove('show');
                    }
                });
                
                // เมื่อ editor ได้รับ focus
                codeEditor.addEventListener('focus', function() {
                    this.style.outline = '2px solid #3b82f6';
                    this.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.1)';
                });
                
                // เมื่อ editor เสีย focus
                codeEditor.addEventListener('blur', function() {
                    this.style.outline = 'none';
                    this.style.boxShadow = 'none';
                });
            }
            
            // โหลดการตั้งค่าธีมที่บันทึกไว้
            function loadTheme() {
                const savedTheme = localStorage.getItem('codeTesterTheme');
                if (savedTheme === 'light') {
                    isDarkMode = false;
                    toggleTheme(); // เรียกเพื่อสลับไปยัง light mode
                }
            }
            
            // เริ่มต้นแอปพลิเคชัน
            function initApp() {
                // โหลดธีมที่บันทึกไว้
                loadTheme();
                
                // ตั้งค่า event listeners
                setupEventListeners();
                
                // ตั้งค่า resizer
                setupResizer();
                
                // ตั้งค่า keyboard shortcuts
                setupKeyboardShortcuts();
                
                // โหลดโค้ดเริ่มต้น
                loadSavedCode();
                
                // อัปเดต line numbers ครั้งแรก
                updateLineNumbers();
                
                // อัปเดตสถิติครั้งแรก
                updateStats();
                
                // แสดงการต้อนรับ
                setTimeout(() => {
                    showNotification('ยินดีต้อนรับ', 'Live Code Tester Pro พร้อมใช้งานแล้ว!', 'success');
                }, 1000);
            }
            
            // เรียกใช้ฟังก์ชันเริ่มต้น
            initApp();
        });
    </script>
</body>
</html>
